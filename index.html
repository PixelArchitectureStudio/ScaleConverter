<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø§Ø¨Ø²Ø§Ø± ØªØ¨Ø¯ÛŒÙ„ Ù…Ù‚ÛŒØ§Ø³</title>
  <style>
    :root { --bg:#0f1320; --card:#161a2b; --muted:#8ea0b9; --text:#eef3ff; --accent:#7aa2ff; }
    *{box-sizing:border-box}
    body{margin:0;background:radial-gradient(1200px 800px at 20% -10%, #1b2140 0%, var(--bg) 60%), var(--bg);min-height:100vh;font-family:ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial; color:var(--text);}    
    .wrap{max-width:860px;margin:40px auto;padding:24px}
    h1{font-size:22px;margin:0 0 16px}
    p.desc{margin:0 0 22px;color:var(--muted)}
    .card{background:linear-gradient(180deg, #1a1f36, #121629);border:1px solid #2a2f47; padding:18px;border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    .row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px}
    label{display:block;font-size:12px;color:#aab8d8;margin:0 0 6px}
    select,input{width:100%;padding:12px 12px;border-radius:12px;border:1px solid #2b3152;background:#0f1326;color:var(--text);outline:none}
    input[type="number"]::-webkit-outer-spin-button,input[type="number"]::-webkit-inner-spin-button{ -webkit-appearance:none; margin:0;}
    .grid{display:grid;gap:16px}
    .hint{font-size:12px;color:#94a3c7}
    .out{background:linear-gradient(180deg, #0f1428, #0b1022);padding:16px;border-radius:14px;border:1px dashed #2f365e;position:relative}
    .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
    .big{font-size:28px; font-weight:700}
    .copy{cursor:pointer;border:1px solid #2b3152;background:#0f1326;color:#cdd7ff;border-radius:10px;padding:8px 10px}
    .flex{display:flex; align-items:center; gap:12px; flex-wrap:wrap}
    .hstack{display:flex; align-items:center; gap:8px}
    .toggle-inline{display:inline-flex; align-items:center; gap:0; white-space:nowrap}
    .toggle-inline .hint{margin:0; line-height:1; padding:0; transform: translateX(-4px);} 
    .toggle-inline input[type="checkbox"]{margin:0; padding:0; width:16px; height:16px; vertical-align:middle;}
    .footer{margin-top:16px; color:#90a4d4; font-size:12px}
    .ig-link{display:inline-flex;align-items:center;gap:6px;margin-inline-start:8px;color:#cdd7ff;text-decoration:none;border:1px solid #2b3152;padding:4px 8px;border-radius:8px}
    .ig-link:hover{border-color:#7aa2ff}
    .ig{width:14px;height:14px}
    .handle{display:inline-flex; flex-direction:row; align-items:center; gap:0; direction:ltr; white-space:nowrap; line-height:1}
    .handle .at{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; display:inline}
    .swap{position:relative}
    .swap > *{width:100%}
    .swap.manual #scaleSelect{display:none}
    .swap.manual #scaleN{display:block}
    .swap:not(.manual) #scaleSelect{display:block}
    .swap:not(.manual) #scaleN{display:none}

    /* --- Light/Dark theme switch --- */
    .topbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
    .actions{display:flex;align-items:center;gap:10px}
    .icon-btn{width:32px;height:32px;display:inline-flex;align-items:center;justify-content:center;border-radius:10px;padding:0;font-size:16px}
    .switch{position:relative;cursor:pointer;border:1px solid #2b3152;background:#0f1326;color:var(--text);border-radius:999px;display:inline-flex;align-items:center;justify-content:center;width:54px;height:28px;padding:0}
    .switch span{pointer-events:none}
    .switch .thumb{position:absolute;top:2px;left:2px;width:24px;height:24px;border-radius:999px;background:var(--accent);box-shadow:0 2px 6px rgba(0,0,0,.35);transition:transform .25s ease}
    .switch .icon{position:absolute;top:50%;transform:translateY(-50%);font-size:12px;opacity:.9}
    .switch .icon.sun{left:8px}
    .switch .icon.moon{right:8px}
    .switch[data-mode="light"] .thumb{transform:translateX(26px)}

    /* Light overrides */
    body.light{background:linear-gradient(180deg,#ffffff,#f6f8ff);color:#0d1220}
    body.light .card{background:#ffffff;border-color:#e2e8f0;box-shadow:0 10px 30px rgba(0,0,0,.06)}
    body.light label{color:#56617a}
    body.light select, body.light input{background:#ffffff;border-color:#cbd5e1;color:#0d1220}
    body.light .out{background:#f4f6fb;border-color:#d0d8e6}
    body.light .copy{background:#ffffff;border-color:#cbd5e1;color:#0d1220}
    body.light .hint{color:#64748b}
    body.light .footer{color:#5f6b88}
    body.light .ig-link{color:#334155;border-color:#cbd5e1}
    body.light .ig-link:hover{border-color:#3b82f6}
    body.light .switch{background:#ffffff;border-color:#cbd5e1;color:#0d1220}

    /* History popover */
    .hist-pop{position:absolute; right:12px; top:100%; margin-top:8px; background:#0f1326; border:1px solid #2b3152; border-radius:12px; width:260px; padding:10px; box-shadow:0 10px 30px rgba(0,0,0,.35); z-index:70}
    .hist-pop.hidden{display:none}
    .hist-head{font-size:12px; color:#94a3c7; margin:0 0 6px}
    .hist-list{list-style:none; padding:0; margin:0; max-height:220px; overflow:auto}
    .hist-list li{font-size:13px; padding:6px 0; border-bottom:1px dashed #2f365e}
    .hist-list li:last-child{border-bottom:none}
    .hist-empty{font-size:12px; color:#94a3c7}
    body.light .hist-pop{background:#ffffff; border-color:#cbd5e1; box-shadow:0 10px 30px rgba(0,0,0,.12)}

    .hstack.toggle-inline{gap:0 !important;}
    .ltr{direction:ltr;text-align:left}
      /* Calc button custom style */
    #calcBtn{background:#7aa2ff;border-color:#7aa2ff;color:#0b1022;width:100%;padding:12px 14px;font-weight:600;font-family:inherit}
    #calcBtn:hover{filter:brightness(.95)}
    #calcBtn:active{transform:translateY(1px)}
    body.light #calcBtn{background:#7aa2ff;border-color:#7aa2ff;color:#0b1022}
      /* custom white arrow for <select> boxes */
    select{
      -webkit-appearance:none; -moz-appearance:none; appearance:none;
      background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path d='M7 10l5 5 5-5' fill='%23ffffff'/></svg>");
      background-repeat:no-repeat;
      background-position:12px center; /* ÙÙ„Ø´ Ø³Ù…Øª Ú†Ù¾ */
      background-size:14px 14px;
      /* Ø±Ø§Ø³Øªâ€ŒÚ†ÛŒÙ† Ø´Ø¯Ù† Ù…ØªÙ† Ø¯Ø§Ø®Ù„ Ø³Ù„Ú©Øª */
      text-align:right;            /* Ø¨Ø±Ø§ÛŒ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ Ø¯Ø± Ø¨Ø±Ø®ÛŒ Ù…Ø±ÙˆØ±Ú¯Ø±Ù‡Ø§ */
      text-align-last:right;       /* Ù…ØªÙ† Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡ */
      direction:rtl;               /* Ø¬Ù‡Øª Ù†ÙˆØ´ØªØ§Ø± */
      /* ÙØ¶Ø§ Ø¨Ø±Ø§ÛŒ ÙÙ„Ø´ Ø³Ù…Øª Ú†Ù¾ ØªØ§ Ø±ÙˆÛŒ Ù…ØªÙ† Ù†ÛŒÙØªÙ‡ */
      padding-left:36px;           /* Ø³Ù…Øª Ú†Ù¾ Ú†ÙˆÙ† ÙÙ„Ø´ Ø¢Ù†Ø¬Ø§Ø³Øª */
      padding-right:12px;
    }
    /* Keep arrow visible on light theme as well (white fill + subtle stroke for contrast) */
    body.light select{
      /* Unify arrow shape; only color changes in light mode */
      -webkit-appearance:none; -moz-appearance:none; appearance:none;
      background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path d='M7 10l5 5 5-5' fill='%230d1220'/></svg>");
      background-repeat:no-repeat;
      background-position:12px center;  /* same position as dark */
      background-size:14px 14px;        /* same size as dark */
      padding-left:36px;                /* keep room for arrow on the left */
      text-align:right; text-align-last:right; direction:rtl;
    }
    /* Hide legacy IE arrow */
    select::-ms-expand{display:none}
    /* Ø¯Ø±Ø§Ù¾â€ŒØ¯Ø§ÙˆÙ† Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ Ù†ÛŒØ² Ø±Ø§Ø³Øªâ€ŒÚ†ÛŒÙ† Ø´ÙˆÙ†Ø¯ */
    select option{direction:rtl; text-align:right;}
      /* Footer bar with version on the opposite side */
    .footer-bar{display:flex;align-items:center;justify-content:space-between;position:relative}
    .version{color:#90a4d4;font-size:12px;border:1px solid #2b3152;border-radius:10px;padding:4px 10px;background:#0f1326;cursor:pointer}
    body.light .version{color:#0d1220;border-color:#cbd5e1;background:#ffffff}
      /* Version popover */
    .ver-pop{position:absolute; left:12px; bottom:calc(100% + 8px); background:#0f1326; border:1px solid #2b3152; border-radius:12px; width:280px; padding:12px; box-shadow:0 10px 30px rgba(0,0,0,.35); z-index:90}
    .ver-pop.hidden{display:none}
    .ver-title{font-weight:700; margin-bottom:6px}
    .ver-hint{font-size:12px; color:#94a3c7; margin-top:6px}
    body.light .ver-pop{background:#ffffff; border-color:#cbd5e1; box-shadow:0 10px 30px rgba(0,0,0,.12)}
      /* Fit viewport & remove page scroll */
    html, body{height:100%}
    body{min-height:100svh;height:100dvh;overflow:hidden}
    @supports (height: 100dvh){ body{height:100dvh} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <h1>Ø§Ø¨Ø²Ø§Ø± ØªØ¨Ø¯ÛŒÙ„ Ù…Ù‚ÛŒØ§Ø³</h1>
      <div class="actions">
        <button id="themeToggle" class="switch" aria-label="ØªØºÛŒÛŒØ± Ø­Ø§Ù„Øª Ø±ÙˆØ´Ù†/ØªØ§Ø±ÛŒÚ©" data-mode="dark">
          <span class="icon sun" aria-hidden="true">â˜€ï¸</span>
          <span class="icon moon" aria-hidden="true">ğŸŒ™</span>
          <span class="thumb" aria-hidden="true"></span>
        </button>
      </div>
    </div>
    <p class="desc">ÙˆØ§Ø­Ø¯ Ø¯Ù†ÛŒØ§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ (Ù‡Ù…ÛŒØ´Ù‡ <strong>Û±:Û±</strong>)ØŒ Ø³Ù¾Ø³ Ù…Ù‚ÛŒØ§Ø³ Ù‡Ø¯Ù <strong>Û±:N</strong> Ùˆ ÙˆØ§Ø­Ø¯ Ù†Ù‚Ø´Ù‡ Ø±Ø§ Ø¨Ø±Ú¯Ø²ÛŒÙ†ÛŒØ¯. Ù…Ù‚Ø¯Ø§Ø± ÙˆØ§Ù‚Ø¹ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ ØªØ§ Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´ÙˆØ¯.</p>

    <div class="card grid" role="form" aria-label="ÙØ±Ù… Ù…Ø¨Ø¯Ù‘Ù„ Ù…Ù‚ÛŒØ§Ø³">
      <div class="row-3">
        <div>
          <label for="realUnit">ÙˆØ§Ø­Ø¯ ÙˆØ§Ù‚Ø¹ÛŒ (Û±:Û±)</label>
          <select id="realUnit" aria-label="ÙˆØ§Ø­Ø¯ ÙˆØ§Ù‚Ø¹ÛŒ">
            <option value="mm">Ù…ÛŒÙ„ÛŒâ€ŒÙ…ØªØ± (mm)</option>
            <option value="cm">Ø³Ø§Ù†ØªÛŒâ€ŒÙ…ØªØ± (cm)</option>
            <option value="m" selected>Ù…ØªØ± (m)</option>
            <option value="km">Ú©ÛŒÙ„ÙˆÙ…ØªØ± (km)</option>
            <option value="in">Ø§ÛŒÙ†Ú† (in)</option>
            <option value="ft">ÙÙˆØª (ft)</option>
            <option value="yd">ÛŒØ§Ø±Ø¯ (yd)</option>
            <option value="mi">Ù…Ø§ÛŒÙ„ (mi)</option>
            <option value="nmi">Ù…Ø§ÛŒÙ„ Ø¯Ø±ÛŒØ§ÛŒÛŒ (nmi)</option>
          </select>
        </div>
        <div>
          <label for="scaleSelect">Ù…Ù‚ÛŒØ§Ø³ Ù‡Ø¯Ù â€” Û±:N</label>
          <div class="grid" style="gap:8px">
            <div id="scaleSwap" class="swap">
              <select id="scaleSelect" aria-label="Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ù‚ÛŒØ§Ø³">
                <optgroup label="Ø¬Ø²Ø¦ÛŒØ§Øª (Detail)">
                  <option value="1">Û±:Û±</option>
                  <option value="2">Û±:Û²</option>
                  <option value="5">Û±:Ûµ</option>
                  <option value="10">Û±:Û±Û°</option>
                </optgroup>
                <optgroup label="Ù†Ù‚Ø´Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø¹Ù…Ø§Ø±ÛŒ (Plans)">
                  <option value="20">Û±:Û²Û°</option>
                  <option value="25">Û±:Û²Ûµ</option>
                  <option value="50">Û±:ÛµÛ°</option>
                  <option value="75">Û±:Û·Ûµ</option>
                  <option value="100">Û±:Û±Û°Û°</option>
                  <option value="125">Û±:Û±Û²Ûµ</option>
                  <option value="150">Û±:Û±ÛµÛ°</option>
                  <option value="200" selected>Û±:Û²Û°Û°</option>
                  <option value="250">Û±:Û²ÛµÛ°</option>
                </optgroup>
                <optgroup label="Ø³Ø§ÛŒØª/Ø´Ù‡Ø± (Site/Urban)">
                  <option value="400">Û±:Û´Û°Û°</option>
                  <option value="500">Û±:ÛµÛ°Û°</option>
                  <option value="1000">Û±:Û±Û°Û°Û°</option>
                  <option value="2000">Û±:Û²Û°Û°Û°</option>
                  <option value="5000">Û±:ÛµÛ°Û°Û°</option>
                </optgroup>
              </select>
              <input id="scaleN" type="number" min="1" step="1" value="200" aria-label="Ø¹Ø¯Ø¯ N Ù…Ù‚ÛŒØ§Ø³" class="ltr" />
            </div>
            <label class="hstack toggle-inline">
              <input type="checkbox" id="manualToggle" />
              <span class="hint">ÙˆØ±ÙˆØ¯ Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡ Ù…Ù‚ÛŒØ§Ø³ Ù‡Ø¯Ù</span>
            </label>
          </div>
        </div>
        <div>
          <label for="targetUnit">ÙˆØ§Ø­Ø¯ Ù†Ù‚Ø´Ù‡</label>
          <select id="targetUnit" aria-label="ÙˆØ§Ø­Ø¯ Ù†Ù‚Ø´Ù‡">
            <option value="mm">Ù…ÛŒÙ„ÛŒâ€ŒÙ…ØªØ± (mm)</option>
            <option value="cm" selected>Ø³Ø§Ù†ØªÛŒâ€ŒÙ…ØªØ± (cm)</option>
            <option value="m">Ù…ØªØ± (m)</option>
            <option value="km">Ú©ÛŒÙ„ÙˆÙ…ØªØ± (km)</option>
            <option value="in">Ø§ÛŒÙ†Ú† (in)</option>
            <option value="ft">ÙÙˆØª (ft)</option>
            <option value="yd">ÛŒØ§Ø±Ø¯ (yd)</option>
            <option value="mi">Ù…Ø§ÛŒÙ„ (mi)</option>
            <option value="nmi">Ù…Ø§ÛŒÙ„ Ø¯Ø±ÛŒØ§ÛŒÛŒ (nmi)</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label for="realValue"><span id="inputLabel">Ø§Ù†Ø¯Ø§Ø²Ù‡ ÙˆØ§Ù‚Ø¹ÛŒ (ÙÙ‚Ø· Ø¹Ø¯Ø¯)</span></label>
          <input id="realValue" type="text" inputmode="decimal" placeholder="Ù…Ø«Ù„Ø§Ù‹ Û±Û²Ù«Ûµ ÛŒØ§ 12.5" aria-label="Ø§Ù†Ø¯Ø§Ø²Ù‡ ÙˆØ§Ù‚Ø¹ÛŒ" class="ltr" dir="ltr" />
          <div class="hint" id="realHint">ÙˆØ§Ø­Ø¯: m</div>
          <div class="flex" style="margin-top:8px">
            <button type="button" class="copy" id="calcBtn" title="Ù…Ø­Ø§Ø³Ø¨Ù‡">Ù…Ø­Ø§Ø³Ø¨Ù‡</button>
          </div>
        </div>
        <div>
          <label><span id="outputLabel">Ø§Ù†Ø¯Ø§Ø²Ù‡Ù” Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡ (Ù…Ø­Ø§Ø³Ø¨Ù‡â€ŒØ´Ø¯Ù‡)</span></label>
          <div class="out">
            <div class="big mono" id="outVal">â€”</div>
            <div class="hint" id="outUnit">ÙˆØ§Ø­Ø¯: cm</div>
            <div class="flex" style="margin-top:8px">
              <button type="button" class="copy" id="copyBtn" title="Ú©Ù¾ÛŒ Ù…Ù‚Ø¯Ø§Ø±">Ú©Ù¾ÛŒ</button>
              <button type="button" class="copy" id="histBtn" title="ØªØ§Ø±ÛŒØ®Ú†Ù‡ Û±Û° Ù…Ù‚Ø¯Ø§Ø± Ø§Ø®ÛŒØ±">ğŸ•˜</button>
              <button id="swapBtn" class="copy icon-btn" title="ØªØ¨Ø¯ÛŒÙ„ Ø¬Ù‡Øª (Ù†Ù‚Ø´Ù‡ â†” ÙˆØ§Ù‚Ø¹ÛŒ)" aria-pressed="false">â‡„</button>
              <span class="hint" id="copyNote"></span>
            </div>
            <div id="histPop" class="hist-pop hidden" role="dialog" aria-label="ØªØ§Ø±ÛŒØ®Ú†Ù‡ Û±Û° Ù…Ù‚Ø¯Ø§Ø± Ø§Ø®ÛŒØ±">
              <div class="hist-head">ØªØ§Ø±ÛŒØ®Ú†Ù‡ (Û±Û° Ù…Ù‚Ø¯Ø§Ø± Ø§Ø®ÛŒØ±)</div>
              <ul id="histList" class="hist-list"></ul>
            </div>
          </div>
        </div>
      </div>

      <div class="grid">
        <div class="hint">Ø¬Ø²Ø¦ÛŒØ§Øª Ù…Ø¨Ø¯Ù„: <span class="mono" id="detail">Û± (ÙˆØ§Ø­Ø¯ ÙˆØ§Ù‚Ø¹ÛŒ) â†’ ØŸ (ÙˆØ§Ø­Ø¯ Ù†Ù‚Ø´Ù‡) Ø¯Ø± Ù…Ù‚ÛŒØ§Ø³ Û±:N</span></div>
        <div class="footer footer-bar">
          <div>Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· <strong>Pixel Studio</strong>
            <a class="ig-link" href="https://instagram.com/Pixel_architecture_studio" target="_blank" rel="noopener" aria-label="Instagram: @Pixel_architecture_studio">
              <svg class="ig" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <rect x="2" y="2" width="20" height="20" rx="5" ry="5" stroke="currentColor" stroke-width="1.5"></rect>
                <circle cx="12" cy="12" r="4" stroke="currentColor" stroke-width="1.5"></circle>
                <circle cx="17.5" cy="6.5" r="1.2" fill="currentColor"></circle>
              </svg>
              <span class="handle"><span class="at" aria-hidden="true">@</span><span class="mono ltr">pixel_architecture_studio</span></span>
            </a>
          </div>
          <button id="versionBtn" class="version mono ltr" type="button" aria-haspopup="dialog" aria-expanded="false" title="Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù†Ø³Ø®Ù‡">v1.2</button>
          <div id="verPop" class="ver-pop hidden" role="dialog" aria-label="Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù†Ø³Ø®Ù‡">
            <div class="ver-title">Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± ØªØ¨Ø¯ÛŒÙ„ Ù…Ù‚ÛŒØ§Ø³</div>
            <div>Ù†Ø³Ø®Ù‡ <span class="mono ltr">1.2</span></div>
            <div class="ver-hint">Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø®Ø¨Ø± Ø´Ø¯Ù† Ø§Ø² Ø¢Ø®Ø±ÛŒÙ† Ø¢Ù¾Ø¯ÛŒØªâ€Œ Ù†Ø±Ù… Ø§ÙØ²Ø§Ø± Ùˆ Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø±ÛŒØŒ Ù¾ÛŒØ¬ Pixel Studio Ø±Ùˆ ÙØ§Ù„Ùˆ Ú©Ù†ÛŒØ¯.</div>
            <a class="ig-link" href="https://instagram.com/Pixel_architecture_studio" target="_blank" rel="noopener" aria-label="Instagram: @Pixel_architecture_studio">
              <svg class="ig" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <rect x="2" y="2" width="20" height="20" rx="5" ry="5" stroke="currentColor" stroke-width="1.5"></rect>
                <circle cx="12" cy="12" r="4" stroke="currentColor" stroke-width="1.5"></circle>
                <circle cx="17.5" cy="6.5" r="1.2" fill="currentColor"></circle>
              </svg>
              <span class="handle"><span class="at" aria-hidden="true">@</span><span class="mono ltr">pixel_architecture_studio</span></span>
            </a>
          </div>
        </div>
      </div>
    </div>

    <div class="footer" style="margin-top:10px">Ù†Ú©ØªÙ‡: Ø¨Ø±Ø§ÛŒ Ù…Ù‚ÛŒØ§Ø³â€ŒØ¯Ø§Ø¯Ù† Ø¨Ù‡ Ù‡Ù†Ø¯Ø³Ù‡ Ø¯Ø± CAD Ø§Ø² <span class="mono ltr">scale factor = 1 / N</span> Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯ (Ù…Ø«Ù„Ø§Ù‹ Ø¨Ø±Ø§ÛŒ <span class="mono ltr">1:200</span>ØŒ Ø¶Ø±ÛŒØ¨ <span class="mono ltr">0.005</span> Ø§Ø³Øª). Ø§ÛŒÙ† Ø§Ø¨Ø²Ø§Ø± ØªØ¨Ø¯ÛŒÙ„ ÙˆØ§Ø­Ø¯Ù‡Ø§ Ø±Ø§ Ø¨Ø§ Ù‡Ù…ÛŒÙ† Ù…Ù‚ÛŒØ§Ø³ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.</div>
  </div>

  <script>
    const unitToMM = { mm:1, cm:10, m:1000, km:1000000, in:25.4, ft:304.8, yd:914.4, mi:1609344, nmi:1852000 };
    const el = (id) => document.getElementById(id);

    const realUnit = el('realUnit');
    const targetUnit = el('targetUnit');
    const scaleSelect = el('scaleSelect');
    const manualToggle = el('manualToggle');
    const scaleSwap = el('scaleSwap');
    const scaleN = el('scaleN');
    const realValue = el('realValue');
    const outVal = el('outVal');
    const outUnit = el('outUnit');
    const realHint = el('realHint');
    const detail = el('detail');
    const copyBtn = el('copyBtn');
    const copyNote = el('copyNote');
    const themeToggle = el('themeToggle');
    const swapBtn = el('swapBtn');
    const inputLabel = el('inputLabel');
    const outputLabel = el('outputLabel');
    const histBtn = el('histBtn');
    const histPop = el('histPop');
    const histList = el('histList');
    const calcBtn = el('calcBtn');
    const versionBtn = el('versionBtn');
    const verPop = el('verPop');
    let lastSavedOut = '';
    let reverseMode = false;

    function fmt(n){ if (Number.isNaN(n)) return 'â€”'; return n.toFixed(6).replace(/\.0+$/,'').replace(/(\.[0-9]*?)0+$/, '$1'); }

    function updateHints(){
      if (reverseMode){
        realHint.textContent = `ÙˆØ§Ø­Ø¯: ${targetUnit.value}`; // input in drawing units
        outUnit.textContent = `ÙˆØ§Ø­Ø¯: ${realUnit.value}`;    // output in real units
      } else {
        realHint.textContent = `ÙˆØ§Ø­Ø¯: ${realUnit.value}`;
        outUnit.textContent = `ÙˆØ§Ø­Ø¯: ${targetUnit.value}`;
      }
    }

    function applyTheme(theme){
      if (theme === 'light') document.body.classList.add('light');
      else document.body.classList.remove('light');
      if (themeToggle){ const isLight = document.body.classList.contains('light'); themeToggle.setAttribute('data-mode', isLight ? 'light' : 'dark'); }
    }

    function initTheme(){
      let theme = localStorage.getItem('theme');
      if (!theme){ try { theme = (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) ? 'light' : 'dark'; } catch(e){ theme = 'dark'; } }
      applyTheme(theme);
    }

    function setManualUI(){ const manual = manualToggle && manualToggle.checked; scaleN.disabled = !manual; scaleSelect.disabled = manual; if (scaleSwap) scaleSwap.classList.toggle('manual', manual); }

    function calcDrawing(rv, rU, N, tU){ const realMM = rv * unitToMM[rU]; const drawingMM = realMM / N; return drawingMM / unitToMM[tU]; }

    function normalizeNumber(str){
      if (!str) return '';
      var s = String(str);
      var fa = 'Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹';
      var ar = 'Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©';
      s = s.replace(/[Û°-Û¹]/g, d => String(fa.indexOf(d)))
           .replace(/[Ù -Ù©]/g, d => String(ar.indexOf(d)));
      s = s.replace(/[Ù¬,\s\u00A0]/g, ''); // remove thousands (Arabic comma, comma), spaces, NBSP
      s = s.replace(/[Ù«ØŒ]/g, '.'); // Arabic/Persian decimal marks â†’ dot
      s = s.replace(/[^0-9.+-]/g, '');
      return s;
    }

    function compute(){
      const rv = parseFloat(normalizeNumber(realValue.value));
      const manual = manualToggle && manualToggle.checked;
      const N = manual ? parseFloat(scaleN.value) : parseFloat(scaleSelect.value);
      const rU = realUnit.value; const tU = targetUnit.value;
      updateHints();
      if (!rv || rv < 0 || !N || N <= 0){ const nLabel = (N && N > 0) ? fmt(N) : (manual ? 'N' : (scaleSelect.value || 'N')); outVal.textContent = 'â€”'; detail.textContent = reverseMode ? `Û± ${tU} â†’ ØŸ ${rU} Ø¯Ø± Ù…Ù‚ÛŒØ§Ø³ Û±:${nLabel}` : `Û± ${rU} â†’ ØŸ ${tU} Ø¯Ø± Ù…Ù‚ÛŒØ§Ø³ Û±:${nLabel}`; return; }
      if (reverseMode){
        // input is drawing value; compute real value
        const realVal = (rv * unitToMM[tU] * N) / unitToMM[rU];
        outVal.textContent = `${fmt(realVal)} ${rU}`; addToHistory(outVal.textContent,{rv, rU, tU, N, reverse:true});
        const oneTargetToReal = (unitToMM[tU] * N) / unitToMM[rU];
        detail.textContent = `Û± ${tU} = ${fmt(oneTargetToReal)} ${rU}  (Ù…Ù‚ÛŒØ§Ø³ Û±:${fmt(N)})`;
      } else {
        // normal: input is real value; compute drawing value
        const drawingVal = calcDrawing(rv, rU, N, tU);
        outVal.textContent = `${fmt(drawingVal)} ${tU}`; addToHistory(outVal.textContent,{rv, rU, tU, N, reverse:false});
        const oneRealToTarget = (unitToMM[rU] / N) / unitToMM[tU];
        detail.textContent = `Û± ${rU} = ${fmt(oneRealToTarget)} ${tU}  (Ù…Ù‚ÛŒØ§Ø³ Û±:${fmt(N)})`;
      }
    }

    function clearOutput(){
      const manual = manualToggle && manualToggle.checked;
      const N = manual ? parseFloat(scaleN.value) : parseFloat(scaleSelect.value);
      const rU = realUnit.value; const tU = targetUnit.value;
      outVal.textContent = 'â€”';
      const nLabel = (N && N > 0) ? fmt(N) : (manual ? 'N' : (scaleSelect.value || 'N'));
      detail.textContent = reverseMode ? `Û± ${tU} â†’ ØŸ ${rU} Ø¯Ø± Ù…Ù‚ÛŒØ§Ø³ Û±:${nLabel}` : `Û± ${rU} â†’ ØŸ ${tU} Ø¯Ø± Ù…Ù‚ÛŒØ§Ø³ Û±:${nLabel}`;
    }

    realUnit.addEventListener('change', ()=>{ updateHints(); clearOutput(); });
    targetUnit.addEventListener('change', ()=>{ updateHints(); clearOutput(); });
    scaleSelect.addEventListener('change', ()=>{ clearOutput(); });
    manualToggle.addEventListener('change', ()=>{ setManualUI(); updateHints(); clearOutput(); });
    scaleN.addEventListener('input', clearOutput);
    realValue.addEventListener('input', clearOutput);
    // Pressing Enter in the real value input triggers calculation
    realValue.addEventListener('keydown', function(e){
      if (e.key === 'Enter' || e.key === 'NumpadEnter'){
        e.preventDefault();
        compute();
      }
    });
    if (calcBtn) calcBtn.addEventListener('click', compute);
    if (themeToggle) themeToggle.addEventListener('click', function(){ const isLight = !document.body.classList.contains('light'); applyTheme(isLight ? 'light' : 'dark'); localStorage.setItem('theme', isLight ? 'light' : 'dark'); });

    copyBtn.addEventListener('click', async () => {
      const raw = outVal.textContent || ''; let val = raw.trim();
      if (!val || val === 'â€”') { copyNote.textContent = 'Ø§Ø¨ØªØ¯Ø§ Ù…Ù‚Ø¯Ø§Ø± Ø±Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ú©Ù†ÛŒØ¯'; setTimeout(()=>{ copyNote.textContent=''; }, 1500); return; }
      const units = ['mm','cm','m','km','in','ft','yd','mi','nmi']; for (let i=0;i<units.length;i++){ const u=units[i]; if (val.endsWith(' '+u)) { val = val.slice(0, -(u.length+1)); break; } }
      let ok = false; if (navigator.clipboard && window.isSecureContext) { try { await navigator.clipboard.writeText(val); ok = true; } catch(e) { ok = false; } }
      if (!ok) { try { const ta=document.createElement('textarea'); ta.value=val; ta.style.position='fixed'; ta.style.left='-1000px'; ta.style.top='-1000px'; ta.style.opacity='0'; document.body.appendChild(ta); ta.focus(); ta.select(); try { ta.setSelectionRange(0, ta.value.length); } catch(e){} ok = document.execCommand('copy'); document.body.removeChild(ta); } catch(e) { ok=false; } }
      copyNote.textContent = ok ? 'Ú©Ù¾ÛŒ Ø´Ø¯!' : 'Ú©Ù¾ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚'; setTimeout(()=>{ copyNote.textContent=''; }, 1500);
    });

    // ---- History helpers ----
    function readHistory(){ try { return JSON.parse(localStorage.getItem('hist')||'[]'); } catch(e){ return []; } }
    function writeHistory(arr){ try { localStorage.setItem('hist', JSON.stringify(arr.slice(0,10))); } catch(e){} }
    function renderHistory(){
      if (!histList) return;
      const arr = readHistory();
      if (!arr.length){ histList.innerHTML = '<li class="hist-empty">Ø®Ø§Ù„ÛŒ</li>'; return; }
      histList.innerHTML = arr.map(i => {
        const m = i.meta || {};
        const rvStr = m && m.reverse ? i.out : `${fmt(m.rv)} ${m.rU || ''}`;
        const scaleStr = (m && typeof m.N !== 'undefined' && !Number.isNaN(m.N)) ? `Û±:${fmt(m.N)}` : 'Û±:N';
        const outStr = i.out; // already includes unit
        const info = `Ø§Ù†Ø¯Ø§Ø²Ù‡ ÙˆØ§Ù‚Ø¹ÛŒ: ${rvStr} | Ù…Ù‚ÛŒØ§Ø³ ${scaleStr}`;
        return `<li class="hist-li"><div class="mono">${outStr}</div><div class="hint">${info}</div></li>`;
      }).join('');
    }
    function addToHistory(outText, meta){ if (!outText || outText==='â€”') return; const arr = readHistory(); if (arr.length && arr[0].out === outText) return; arr.unshift({out: outText, meta: meta||null, t: Date.now()}); writeHistory(arr); if (histPop && !histPop.classList.contains('hidden')) renderHistory(); lastSavedOut = outText; }
    function toggleHistory(show){ if (!histPop) return; const open = !histPop.classList.contains('hidden'); const willOpen = (typeof show==='boolean') ? show : !open; if (willOpen){ histPop.classList.remove('hidden'); renderHistory(); } else { histPop.classList.add('hidden'); } }
    if (histBtn){ histBtn.addEventListener('click', function(e){ e.stopPropagation(); toggleHistory(); }); }
    function toggleVersion(show){ if (!verPop || !versionBtn) return; const open = !verPop.classList.contains('hidden'); const willOpen = (typeof show==='boolean') ? show : !open; if (willOpen){ verPop.classList.remove('hidden'); versionBtn.setAttribute('aria-expanded','true'); } else { verPop.classList.add('hidden'); versionBtn.setAttribute('aria-expanded','false'); } }
    if (versionBtn){ versionBtn.addEventListener('click', function(e){ e.stopPropagation(); toggleVersion(); }); }
    document.addEventListener('click', function(e){
      if (histPop && !histPop.classList.contains('hidden')){
        if (!(histPop.contains(e.target) || (histBtn && histBtn.contains(e.target)))) toggleHistory(false);
      }
      if (verPop && !verPop.classList.contains('hidden')){
        if (!(verPop.contains(e.target) || (versionBtn && versionBtn.contains(e.target)))) toggleVersion(false);
      }
    });
    document.addEventListener('keydown', function(e){ if (e.key === 'Escape'){ toggleHistory(false); toggleVersion(false); } });

    function applyModeUI(){ if (inputLabel && outputLabel){ if (reverseMode){ inputLabel.textContent = 'Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡ (ÙˆØ±ÙˆØ¯ÛŒ)'; outputLabel.textContent = 'Ø§Ù†Ø¯Ø§Ø²Ù‡ ÙˆØ§Ù‚Ø¹ÛŒ (Ù…Ø­Ø§Ø³Ø¨Ù‡â€ŒØ´Ø¯Ù‡)'; } else { inputLabel.textContent = 'Ø§Ù†Ø¯Ø§Ø²Ù‡ ÙˆØ§Ù‚Ø¹ÛŒ (ÙÙ‚Ø· Ø¹Ø¯Ø¯)'; outputLabel.textContent = 'Ø§Ù†Ø¯Ø§Ø²Ù‡Ù” Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡ (Ù…Ø­Ø§Ø³Ø¨Ù‡â€ŒØ´Ø¯Ù‡)'; } } }

    if (swapBtn){ swapBtn.addEventListener('click', function(){ reverseMode = !reverseMode; try { localStorage.setItem('reverseMode', reverseMode ? '1' : '0'); } catch(e){} this.setAttribute('aria-pressed', reverseMode ? 'true' : 'false'); applyModeUI(); updateHints(); clearOutput(); }); }

    // ===== Initialize =====
    initTheme();
    try { reverseMode = localStorage.getItem('reverseMode') === '1'; } catch(e) { reverseMode = false; }
    if (swapBtn) swapBtn.setAttribute('aria-pressed', reverseMode ? 'true' : 'false');
    applyModeUI();

    // Per request: always start with an empty history on each open
    try { localStorage.removeItem('hist'); } catch(e) {}

    updateHints();
    setManualUI();
    clearOutput();

    // ===== Console self-tests =====
    (function(){
      const tests = [];
      // normalizeNumber
      tests.push({name:'Persian digits â†’ Latin', got: normalizeNumber('Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹Û°'), expect:'1234567890'});
      tests.push({name:'Arabic digits â†’ Latin', got: normalizeNumber('Ù¡Ù¢Ù£Ù«Ù¤Ù¥'), expect:'123.45'});
      tests.push({name:'Thousands & decimal', got: normalizeNumber('Û±Ù¬Û²Û³Û´Ù«ÛµÛ¶'), expect:'1234.56'});
      // forward scale
      const f1 = calcDrawing(2,'m',200,'mm'); // 2m at 1:200 â†’ 10mm
      const f2 = calcDrawing(1,'m',100,'cm'); // 1m at 1:100 â†’ 1cm
      const f3 = calcDrawing(5,'cm',5,'mm');  // 5cm at 1:5 â†’ 10mm
      tests.push({name:'2 m @1:200 â†’ 10 mm', got:f1, expect:10, approx:true});
      tests.push({name:'1 m @1:100 â†’ 1 cm', got:f2, expect:1, approx:true});
      tests.push({name:'5 cm @1:5 â†’ 10 mm', got:f3, expect:10, approx:true});
      // reverse mode check: 0.5 cm at 1:200 equals 1 m
      const rvReal = (0.5 * unitToMM['cm'] * 200) / unitToMM['m'];
      tests.push({name:'0.5 cm @1:200 â†’ 1 m (reverse)', got:rvReal, expect:1, approx:true});
      // round-trip check: forward then reverse should return original
      const forwardVal = calcDrawing(2,'m',200,'mm');
      const backVal = (forwardVal * unitToMM['mm'] * 200) / unitToMM['m'];
      tests.push({name:'round-trip 2m â†” 10mm', got:backVal, expect:2, approx:true});

      let pass = 0;
      function near(a,b,eps=1e-9){ return Math.abs(a-b) < eps; }
      tests.forEach(t=>{ const ok = t.approx ? near(t.got,t.expect) : (t.got===t.expect); console[ok?'log':'error'](`[Test] ${t.name}:`, ok?'PASS':'FAIL', 'â†’ got:', t.got, 'expect:', t.expect); if (ok) pass++; });
      console.log(`[Test] ${pass}/${tests.length} passed`);
    })();
  </script>
</body>
</html>
